<!DOCTYPE html><html><head>
      <title>sessionization</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css">
      
      
      
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid@8.10.2/dist/mermaid.min.js"></script>
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header undefined" id="improved-session-aggregation-for-the-spark-dataset-runner-in-apache-beam">Improved session aggregation for the Spark Dataset runner in Apache Beam.</h1>

<p><a href="https://beam.apache.org/about/">Apache Beam</a> is an open-source SDK for data pipelines that unifies batch and stream processing in a single API and supports various languages and runtime environments <!--- execution environments?? -->, such as Apache Spark, Apache Flink or Dataflow.</p>
<p>Apache Beam plays an important part in many of our product offerings at Talend and we are committed to contribute to the ongoing evolution of Beam.</p>
<ul>
<li><a href="#runners-in-beam">Runners in Beam</a></li>
<li><a href="#aggregations-in-beam">Aggregations in Beam</a>
<ul>
<li><a href="#aggregations-on-non-merging-windows">Aggregations on non-merging windows</a></li>
<li><a href="#aggregations-on-session-windows">Aggregations on session windows</a>
<ul>
<li><a href="#canonical-window-merging-in-beam">Canonical window merging in Beam</a></li>
<li><a href="#optimized-session-aggregator">Optimized session aggregator</a>
<ul>
<li><a href="#adding-values-to-the-aggregation-buffer">Adding values to the aggregation buffer</a></li>
<li><a href="#merging-aggregation-buffers">Merging aggregation buffers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#benchmarks">Benchmarks</a>
<ul>
<li><a href="#nexmark">Nexmark</a>
<ul>
<li><a href="#results">Results</a></li>
</ul>
</li>
<li><a href="#jmh-micro-benchmark">JMH micro-benchmark</a>
<ul>
<li><a href="#results-1">Results</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
<h2 class="mume-header" id="runners-in-beam">Runners in Beam</h2>

<p>The responsibility of a runner in Beam is to translate Beam pipelines into a native pipeline for the respective runtime environment, e.g. Apache Spark, and run the pipeline. This abstraction obviously provides great flexibility to users.
To learn more about Beam runners and how the translation of pipelines is done, I recommend reading <a href="https://echauchot.blogspot.com/2020/02/understand-apache-beam-runners-focus-on.html">this introduction</a> of our colleague Etienne.</p>
<p>Beam&#x2019;s runner for Apache Spark is based on Spark&#x2019;s <code>RDD</code> API (in batch mode). However, there&#x2019;s also a new, experimental runner using Spark SQL with the more recent <code>Dataset</code> API. In the following we&#x2019;re going to explore how to improve the performance of aggregations on <a href="https://beam.apache.org/documentation/programming-guide/#session-windows">Session windows</a> for that runner.</p>
<p>A <code>Dataset</code> in Spark depends on an <code>Encoder</code> for (de-)serialization of data similar to <code>Coder</code>s in Beam.
These convert a data point from and to a binary representation and are critical to efficiently move data between nodes of the distributed compute system.
In the following we are going to ignore that aspect as it&#x2019;s a subject of its own.</p>
<h2 class="mume-header" id="aggregations-in-beam">Aggregations in Beam</h2>

<p>Aggregations in Beam aka <a href="https://beam.apache.org/documentation/programming-guide/#combine"><code>Combine</code> transforms</a> are based on associative and commutative <code>CombineFn</code> functions.</p>
<p>In the following we&#x2019;re looking to translate a <code>Combine.PerKey&lt;KeyT, InputT, OutputT&gt;</code>. Simply said, this is an aggregation per key.</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">CombineFn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputT</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">,</span> <span class="token class-name">OutputT</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

  <span class="token comment">// A new empty accumulator.</span>
  <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token class-name">AccumT</span> <span class="token function">createAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Add a value to the accumulator.</span>
  <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token class-name">AccumT</span> <span class="token function">addInput</span><span class="token punctuation">(</span><span class="token class-name">AccumT</span> accumulator<span class="token punctuation">,</span> <span class="token class-name">InputT</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Merge multiple accumulators.</span>
  <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token class-name">AccumT</span> <span class="token function">mergeAccumulators</span><span class="token punctuation">(</span><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> accumulators<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Extract the output of the resulting accumulator.</span>
  <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token class-name">OutputT</span> <span class="token function">extractOutput</span><span class="token punctuation">(</span><span class="token class-name">AccumT</span> accumulator<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</pre><p>The respective counterpart in Spark is an <code>Aggregator</code>, which is functionally very similar to the above:</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Aggregator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputT</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">,</span> <span class="token class-name">OutputT</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

  <span class="token comment">// A new empty accumulator.</span>
  <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token class-name">AccumT</span> <span class="token function">zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// Add a value to the accumulator.</span>
  <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token class-name">AccumT</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">AccumT</span> accumulator<span class="token punctuation">,</span> <span class="token class-name">InputT</span> input<span class="token punctuation">)</span>

  <span class="token comment">// Merge two accumulators.</span>
  <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token class-name">AccumT</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token class-name">AccumT</span> accumulator1<span class="token punctuation">,</span> <span class="token class-name">AccumT</span> accumulator2<span class="token punctuation">)</span>

  <span class="token comment">// Extract the output of the resulting accumulator.</span>
  <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-abstract">abstract</span> <span class="token class-name">OutputT</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token class-name">AccumT</span> accumulator<span class="token punctuation">)</span>

  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="aggregations-on-non-merging-windows">Aggregations on non-merging windows</h3>

<p>Windows sub-devide datasets according to timestamps of individual data points, e.g. the data per fixed hourly window.
The concept of windowing is critical when working with unbounded streams of data, but it also applies to batch processing, and scopes
transformations such as aggregations to the respective window.</p>
<p>In Beam&#x2019;s <a href="https://beam.apache.org/documentation/programming-guide/#windowing">windowing model</a> every data point is assigned to one or several windows and
represented as <code>WindowedValue&lt;T&gt;</code>. In batch this is by default a single global window, meaning everything.
Our colleague Alexey wrote an <a href="https://aromanenko.blogspot.com/2019/03/data-processing-using-beam-part-3.html">introduction to Beam windowing</a> if you&#x2019;re looking for further information.</p>
<p>Fixed, non-merging bounded windows, including the single global window, are the simplest case when translating <code>Combine.PerKey&lt;KeyT, InputT, OutputT&gt;</code> transforms.
These windows are independent of windows of other data points, so we don&#x2019;t have to evaluate and potentially merge them in the Spark aggregator.
Instead we can move the windows into a composite key (BoundedWindow, KeyT).
Especially if there&#x2019;s only few keys, this can even help to better scale out and mitigate potential problems due to skew in the data.</p>
<p>However, a windowed value <code>WindowedValue&lt;T&gt;</code> could be assigned to multiple windows. For instance, that&#x2019;s the case with sliding windows:</p>
<p>Consider a sliding window of 1 hour that advances ever 5 minutes. For each key we get 12 new composite keys.
That raises the question if we risk to massively increase the amount of data that needs to be shuffled around when assigning each value to 12 instead of just 1 key when grouping the data by the composite key?</p>
<p>Luckily no, Spark will perform a map-side (aka local) <code>reduce</code> using the <code>Aggregator</code> first.
This means all rows of a partition belonging to the same key will be reduced into an accumulator locally.
Afterwards, these intermediate accumulators, containing a partial aggregation each, will be shuffled and merged.
This takes advantage of the associative and commutative property of the aggregation (aka combine) function.</p>
<p>The following code snippet shows the translation of <code>Combine.PerKey</code> transforms on non-merging windows in the experimental Spark runner:</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword keyword-final">final</span> <span class="token class-name">CombineFn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputT</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">,</span> <span class="token class-name">OutputT</span><span class="token punctuation">&gt;</span></span> combineFn<span class="token punctuation">;</span>
<span class="token keyword keyword-final">final</span> <span class="token class-name">Dataset</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WindowedValue</span><span class="token punctuation">&lt;</span>KV<span class="token punctuation">&lt;</span><span class="token class-name">KeyT</span><span class="token punctuation">,</span> <span class="token class-name">InputT</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> dataset<span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword keyword-final">final</span> <span class="token class-name">Aggregator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputT</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">,</span> <span class="token class-name">OutputT</span><span class="token punctuation">&gt;</span></span> inputAgg <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Aggregator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputT</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">,</span> <span class="token class-name">OutputT</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword keyword-public">public</span> <span class="token class-name">AccumT</span> <span class="token function">zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> combineFn<span class="token punctuation">.</span><span class="token function">createAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword keyword-public">public</span> <span class="token class-name">AccumT</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">AccumT</span> accum<span class="token punctuation">,</span> <span class="token class-name">InputT</span> in<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> combineFn<span class="token punctuation">.</span><span class="token function">addInput</span><span class="token punctuation">(</span>accum<span class="token punctuation">,</span> in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword keyword-public">public</span> <span class="token class-name">AccumT</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token class-name">AccumT</span> accum1<span class="token punctuation">,</span> <span class="token class-name">AccumT</span> accum2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> combineFn<span class="token punctuation">.</span><span class="token function">mergeAccumulators</span><span class="token punctuation">(</span><span class="token class-name">ImmutableList</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>accum1<span class="token punctuation">,</span> accum2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword keyword-public">public</span> <span class="token class-name">OutputT</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token class-name">AccumT</span> accum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> combineFn<span class="token punctuation">.</span><span class="token function">extractOutput</span><span class="token punctuation">(</span>accum<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Dataset</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WindowedValue</span><span class="token punctuation">&lt;</span>KV<span class="token punctuation">&lt;</span><span class="token class-name">KeyT</span><span class="token punctuation">,</span> <span class="token class-name">OutputT</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> aggregatedDataset <span class="token operator">=</span> dataset

  <span class="token comment">// explode combinations of BoundedWindow and KV pair (KeyT, InputT) to tuples of composite key (BoundedWindow, KeyT) and value InputT</span>
  <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token function">explodeWindowedKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment">// Dataset&lt;Tuple2&lt;Tuple2&lt;BoundedWindow, KeyT&gt;, InputT&gt;&gt;</span>

  <span class="token comment">// group dataset by composite key</span>
  <span class="token punctuation">.</span><span class="token function">groupByKey</span><span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token operator">::</span><span class="token function">_1</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment">// KeyValueGroupedDataset&lt;Tuple2&lt;BoundedWindow, KeyT&gt;, Tuple2&lt;Tuple2&lt;BoundedWindow, KeyT&gt;, InputT&gt;&gt;</span>

  <span class="token comment">// drop composite key on the value side (the aggregation input)</span>
  <span class="token punctuation">.</span><span class="token function">mapValues</span><span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token operator">::</span><span class="token function">_2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment">// KeyValueGroupedDataset&lt;Tuple2&lt;BoundedWindow, KeyT&gt;, InputT&gt;</span>

  <span class="token comment">// aggregate InputT per composite key to OutputT</span>
  <span class="token punctuation">.</span><span class="token function">agg</span><span class="token punctuation">(</span>inputAgg<span class="token punctuation">.</span><span class="token function">toColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Dataset&lt;Tuple2&lt;Tuple2&lt;BoundedWindow, KeyT&gt;, OutputT&gt;&gt;</span>

  <span class="token comment">// wrap aggregated KV pair (KeyT, OutputT) into WindowedValue of respective BoundedWindow</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">windowedKV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><h3 class="mume-header" id="aggregations-on-session-windows">Aggregations on session windows</h3>

<p>Sessions are bounded time intervals of activity separated by periods of no input, the gap duration.
Other than the fixed, non-merging windows discussed above, sessions windows are dynamic in nature and depend on windows of other data points.</p>
<p>The following graph taken from <a href="https://beam.apache.org/documentation/programming-guide/#session-windows">Beam documentation</a> illustrates this.</p>
<p><img src="https://beam.apache.org/images/session-windows.png" alt="Session windows"></p>
<p>In Beam, by convention, we append the gap duration to each window.
This time, the aggregator has to keep track of windows and merge these, as well as associated accumulators, if they intersect.</p>
<p><code>Aggregator</code> and <code>CombineFn</code> cannot share the same accumulator type <code>AccumT</code> anymore, as done for non-merging windows above.
To not confuse the different accumulators, we are going to instead call the aggregation state of the <code>Aggregator</code> buffer from now on.</p>
<h4 class="mume-header" id="canonical-window-merging-in-beam">Canonical window merging in Beam</h4>

<p>Beam&#x2019;s <strong>canonical implementation</strong> to merge session windows is very general, but not well fitted for this use case. Have a look at the following code snippet from <a href="https://github.com/apache/beam/blob/5520fe064fc3b7196998d4597746119691eb6681/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/windowing/MergeOverlappingIntervalWindows.java#L39-L63"><img src="github.png" style="height:16px;"> apache/beam</a>, in particular the highlighted lines:</p>
<pre data-role="codeBlock" data-info="java {.line-numbers, highlight=6-10}" class="language-java line-numbers" data-line="6-10"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">mergeWindows</span><span class="token punctuation">(</span><span class="token class-name">WindowFn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token class-name">IntervalWindow</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>MergeContext c<span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  <span class="token comment">// Merge any overlapping windows into a single window.</span>
  <span class="token comment">// Sort the list of existing windows so we only have to</span>
  <span class="token comment">// traverse the list once rather than considering all</span>
  <span class="token comment">// O(n^2) window pairs.</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">&gt;</span></span> sortedWindows <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name">IntervalWindow</span> window <span class="token operator">:</span> c<span class="token punctuation">.</span><span class="token function">windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sortedWindows<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sortedWindows<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MergeCandidate</span><span class="token punctuation">&gt;</span></span> merges <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">MergeCandidate</span> current <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">MergeCandidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name">IntervalWindow</span> window <span class="token operator">:</span> sortedWindows<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">.</span><span class="token function">intersects</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      current<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
      merges<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
      current <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">MergeCandidate</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  merges<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name">MergeCandidate</span> merge <span class="token operator">:</span> merges<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    merge<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6-10" data-start="6" data-end="10">




</div></div></pre><p>For each input, we&#x2019;d be creating a copy of the current windows (all windows in the buffer plus all additional windows assigned to the input) and sort them to find merge candidates.
Especially when the number of session windows is large, this is becoming more and more a performance issue. Further down this can be well-observed in the benchmarks.</p>
<h4 class="mume-header" id="optimized-session-aggregator">Optimized session aggregator</h4>

<p>To prevent such performance issues, a session aggregator implementation would require to efficiently</p>
<ul>
<li>check the buffer for a preceding (or started simultaneously) window and all subsequent windows that intersect with the input window without having to repeatedly sort windows;</li>
<li>remove intersecting windows from the buffer;</li>
<li>and last but not least, add new windows.</li>
</ul>
<p>Sorted, tree based maps are likely the most obvious fit for above requirements.
In the following we&#x2019;re going to explore an implementation based on Java&#x2019;s <code>TreeMap</code>, a self-balancing Red-Black tree.</p>
<p>The aggregator will be of the following type:</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token class-name">Aggregator</span><span class="token operator">&lt;</span>
  <span class="token comment">// Windowed key-value pairs as input</span>
  <span class="token class-name">WindowedValue</span><span class="token generics"><span class="token punctuation">&lt;</span>KV<span class="token punctuation">&lt;</span><span class="token class-name">KeyT</span><span class="token punctuation">,</span> <span class="token class-name">InputT</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
  <span class="token comment">// TreeMap based aggregation buffer to track accumulated inputs per session IntervalWindow</span>
  <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
  <span class="token comment">// Collection of windowed output values, one per accumulated session</span>
  <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WindowedValue</span><span class="token punctuation">&lt;</span><span class="token class-name">OutputT</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span>
<span class="token operator">&gt;</span>
</pre><p><strong>Note</strong>:</p>
<p>To reduce complexity for demonstration purposes, we assume a <code>WindowingStrategy</code> with timestamp combiner <code>END_OF_WINDOW</code>.
Support for Beam&#x2019;s windowing model is still partial that way.
Similar to the way combine functions aggregate input values, timestamp combiners aggregate input timestamps to assign one resulting timestamp to the windowed aggregation result <code>WindowedValue&lt;OutputT&gt;</code>.</p>
<p>In case of the default combiner <code>END_OF_WINDOW</code>, this timestamp is always the end of the session <code>IntervalWindow</code> and doesn&#x2019;t depend on individual input timestamps. A feature-complete implementation supporting timestamp combiners can be found on <a href="https://github.com/apache/beam/blob/3a4d57eb8976c5f503b32d478a80b1800490f66f/runners/spark/3/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/Aggregators.java"><img src="github.png" style="height:16px;"> apache/beam</a>.</p>
<h5 class="mume-header" id="adding-values-to-the-aggregation-buffer">Adding values to the aggregation buffer</h5>

<p>Using the sorted tree based aggregation buffer, we can traverse the tree in order starting from the window preceding (or matching the start of) the input window if it intersects the input window, or from the following window otherwise. From there we continue to traverse the tree as long as windows intersect the input window which we continuously expand during the process. Alongside that, we have to merge corresponding accumulators.</p>
<p>Once done, we have to remove all windows we&#x2019;ve merged while traversing the tree. And finally add the input value to the merged accumulator (or a new empty accumulator otherwise) and insert it into the tree together with the expanded window.
Adding the input last to the accumulator helps avoiding unnecessary allocations as we only create a new, empty accumulator if needed.</p>
<p>The following sequence of <code>reduce</code> operations for a single key illustrates the above process. The input is highlighted in red:</p>
<ol>
<li>
<p>No window precedes input <code>7</code> and <code>[4]</code> doesn&#x2019;t intersect; create an empty accumulator <code>[]</code>, add <code>7</code> to it and insert it (into the tree).</p>
<div class="mermaid">gantt
    dateFormat  Y
    axisFormat  %y
    todayMarker off

    section Key 1
    7   :crit,1, 3
    [4] :6,9
    [2] :14,15
</div></li>
<li>
<p>The previous <code>[4]</code> doesn&#x2019;t intersect input <code>5</code>, nor does <code>[2]</code>; create an empty accumulator <code>[]</code>, add <code>5</code> to it and insert it.</p>
<div class="mermaid">gantt
    dateFormat  Y
    axisFormat  %y
    todayMarker off

    section Key 1
    [7] :1, 3
    [4] :6,9
    5   :crit,10,12
    [2] :14,15
</div></li>
<li>
<p><code>[4]</code> matches start of input <code>4</code>, create a window that spans both; the following <code>[5]</code> doesn&#x2019;t intersect; remove accumulator <code>[4]</code> and its window (from the tree), add <code>4</code> to <code>[4]</code> and insert the updated window and accumulator.</p>
<div class="mermaid">gantt
    dateFormat  Y
    axisFormat  %y
    todayMarker off

    section Key 1
    [7] :1,3
    4   :crit,6,8
    [4] :6,9
    [5] :10,12
    [2] :14,15
</div></li>
<li>
<p>The previous <code>[7]</code> doesn&#x2019;t intersect input <code>4</code>, but <code>[8]</code> does; create a window that spans both; <code>[5]</code> doesn&#x2019;t intersect anymore; remove accumulator <code>[8]</code> and its window, add <code>4</code> to <code>[8]</code> and insert the updated window and accumulator.</p>
<div class="mermaid">gantt
    dateFormat  Y
    axisFormat  %y
    todayMarker off

    section Key 1
    [7] :1,3
    4   :crit,5,7
    [8] :6,9
    [5] :10,12
    [2] :14,15
</div></li>
<li>
<p>The previous <code>[7]</code> intersects input <code>9</code>, create a window that spans both; <code>[12]</code> intersects as well, expand the window again and merge <code>[12]</code> into <code>[7]</code>; <code>[5]</code> still intersects, expand the window again and merge <code>[5]</code> into <code>[12+7]</code>; <code>[2]</code> doesn&#x2019;t intersect anymore; remove <code>[12]</code> and <code>[5]</code> and their windows; finally add <code>9</code> to <code>[12+7+5]</code> and insert the updated window and accumulator.</p>
<div class="mermaid">gantt
  dateFormat  Y
  axisFormat  %y
  todayMarker off

  section Key 1
  [7] :1,3
  9   :crit,3,11
  [12] :5,9
  [5] :10,12
  [2] :14,15
</div></li>
<li>
<p>After the sequence of <code>reduce</code> operations, our aggreagation buffer for &#x201C;Key 1&#x201D; looks as follows:</p>
<div class="mermaid">gantt
  dateFormat  Y
  axisFormat  %y
  todayMarker off

  section Key 1
  [33] :1,12
  [2] :14,15
</div></li>
</ol>
<p>The code below implements the algorithm described above. As mentioned above, you can find the full, feature-complete implementation on <a href="https://github.com/apache/beam/blob/3a4d57eb8976c5f503b32d478a80b1800490f66f/runners/spark/3/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/Aggregators.java#L188-L228"><img src="github.png" style="height:16px;"> apache/beam</a>.</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Combine<span class="token punctuation">.</span>CombineFn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputT</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">,</span> <span class="token class-name">OutputT</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword keyword-public">public</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> buff<span class="token punctuation">,</span> <span class="token class-name">WindowedValue</span><span class="token generics"><span class="token punctuation">&lt;</span>KV<span class="token punctuation">&lt;</span><span class="token class-name">KeyT</span><span class="token punctuation">,</span> <span class="token class-name">InputT</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// for each input window</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name">IntervalWindow</span> window <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> input<span class="token punctuation">.</span><span class="token function">getWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AccumT</span> acc <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
    <span class="token class-name">IntervalWindow</span> first <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> last <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
    <span class="token comment">// start with window before or equal to new window (if exists)</span>
    <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> lower <span class="token operator">=</span> buff<span class="token punctuation">.</span><span class="token function">floorEntry</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>lower <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span><span class="token function">intersects</span><span class="token punctuation">(</span>lower<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// if intersecting, init accumulator and extend window to span both</span>
      acc <span class="token operator">=</span> lower<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      window <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">span</span><span class="token punctuation">(</span>lower<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      first <span class="token operator">=</span> last <span class="token operator">=</span> lower<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// merge following windows in order if they intersect, then stop</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> buff<span class="token punctuation">.</span><span class="token function">tailMap</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">AccumT</span> entryAcc <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">IntervalWindow</span> entryWindow <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">intersects</span><span class="token punctuation">(</span>entryWindow<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// extend window and merge accumulators</span>
        window <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">span</span><span class="token punctuation">(</span>entryWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        acc <span class="token operator">=</span> acc <span class="token operator">==</span> <span class="token keyword keyword-null">null</span> <span class="token operator">?</span> entryAcc <span class="token operator">:</span> fn<span class="token punctuation">.</span><span class="token function">mergeAccumulators</span><span class="token punctuation">(</span><span class="token class-name">ImmutableList</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> entryAcc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>first <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// there was no previous (lower) window intersecting the input window</span>
          first <span class="token operator">=</span> last <span class="token operator">=</span> entryWindow<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
          last <span class="token operator">=</span> entryWindow<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span> <span class="token comment">// stop, later windows won&apos;t intersect either</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>first <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token operator">&amp;&amp;</span> last <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// remove entire subset from from first to last after it got merged into acc</span>
      buff<span class="token punctuation">.</span><span class="token function">navigableKeySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subSet</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> last<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>acc <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// init accumulator if necessary</span>
      acc <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">createAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// add input and set accumulator for new (potentially merged) window</span>
    buff<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> fn<span class="token punctuation">.</span><span class="token function">addInput</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> input<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword keyword-return">return</span> buff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h5 class="mume-header" id="merging-aggregation-buffers">Merging aggregation buffers</h5>

<p>The idea to merge our tree buffers is simple; we traverse both trees in order and always pick the next smallest window according to the window start time. While it intersects a previous one, we expan the windows and merge the accumulators, if not we add it to a new tree buffer and continue until there&#x2019;s no more windows; once the final window is added we&#x2019;re done.</p>
<p>The following code implements the merge operation. Once again, the full, feature-complete implementation is available on <a href="https://github.com/apache/beam/blob/3a4d57eb8976c5f503b32d478a80b1800490f66f/runners/spark/3/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/Aggregators.java#L231-L271"><img src="github.png" style="height:16px;"> apache/beam</a>.</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword keyword-public">public</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> buff1<span class="token punctuation">,</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> buff2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>buff1<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> buff2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>buff2<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> buff1<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Init new tree map to merge both buffers</span>
  <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> <span class="token function">zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">PeekingIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> it1 <span class="token operator">=</span>
      <span class="token class-name">Iterators</span><span class="token punctuation">.</span><span class="token function">peekingIterator</span><span class="token punctuation">(</span>buff1<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">PeekingIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> it2 <span class="token operator">=</span>
      <span class="token class-name">Iterators</span><span class="token punctuation">.</span><span class="token function">peekingIterator</span><span class="token punctuation">(</span>buff2<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">AccumT</span> acc <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
  <span class="token class-name">IntervalWindow</span> window <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>it1<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> it2<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// pick iterator with the smallest window ahead and forward it</span>
    <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalWindow</span><span class="token punctuation">,</span> <span class="token class-name">AccumT</span><span class="token punctuation">&gt;</span></span> nextMin <span class="token operator">=</span>
        <span class="token punctuation">(</span>it1<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> it2<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">?</span> it1<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>it2<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">?</span> it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> it2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">:</span> it1<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> it2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>window <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span><span class="token function">intersects</span><span class="token punctuation">(</span>nextMin<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// extend window and merge accumulators if windows intersect</span>
      window <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">span</span><span class="token punctuation">(</span>nextMin<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      acc <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">mergeAccumulators</span><span class="token punctuation">(</span><span class="token class-name">ImmutableList</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> nextMin<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// store window / accumulator if necessary and continue with next minimum</span>
      <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>window <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token operator">&amp;&amp;</span> acc <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      acc <span class="token operator">=</span> nextMin<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      window <span class="token operator">=</span> nextMin<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>window <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token operator">&amp;&amp;</span> acc <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h2 class="mume-header" id="benchmarks">Benchmarks</h2>

<h3 class="mume-header" id="nexmark">Nexmark</h3>

<p>Apache Beam contains a benchmark suite called Nexmark consisting of multiple &#x201C;real-world&#x201D; queries over a three entities model representing an online auction system.
If you&#x2019;re interested to learn more, I recommend reading the <a href="https://echauchot.blogspot.com/2020/06/nexmark-benchmark-and-ci-tool-for.html">introduction to nexmark</a> of our colleague Etienne.</p>
<p>Nexmark doesn&#x2019;t necessarily give an accurate overall number as it&#x2019;s running locally and certain aspects such as serialization and shuffling data are simply ignored.
Nevertheless, it will give us a decent estimate how the optimized aggregator performs compared to an aggregator using the canonical window merging of Beam when reducing partitions.</p>
<p>In the following we&#x2019;re looking at Nexmark Query 11 (user sessions).</p>
<h5 class="mume-header" id="results">Results</h5>

<p>The boxplot charts below visualize runtime and throughput for 1 million and 10 million input events based on 10 individual benchmark runs in either case.
The black bar depicts the median.</p>
<p><!--?xml version="1.0" encoding="utf-8"?-->

<svg class="marks" width="840" height="340" viewBox="0 0 840 340" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink"><rect width="840" height="340" style="fill: white;"/><g transform="translate(48,28)"><g class="mark-group role-frame root"><g transform="translate(0,0)"><path class="background" d="M0,0h0v300h0Z" style="fill: none;"/><g><g class="mark-group role-scope concat_0_group"><g transform="translate(0,0)"><path class="background" d="M0,0h0v0h0Z" style="fill: none;"/><g><g class="mark-group role-scope concat_0_concat_0_group"><g transform="translate(0,0)"><path class="background" d="M0.5,0.5h100v300h-100Z" style="fill: none; stroke: #ddd;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-grid" style="pointer-events: none;"><line transform="translate(0,300)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,293)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,285)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,278)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,270)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,263)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,255)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,248)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,240)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,232)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,225)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,217)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,210)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,202)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,195)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,187)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,180)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,172)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,165)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,158)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,143)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,135)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,128)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,120)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,113)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,105)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,98)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,90)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,83)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,75)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,68)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,60)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,53)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,45)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,38)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,30)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,23)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,15)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,8)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-group role-axis"><g transform="translate(0.5,300.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(25,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(75,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,293)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,285)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,278)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,270)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,263)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,255)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,248)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,240)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,232)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,225)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,217)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,210)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,202)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,195)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,187)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,180)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,172)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,165)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,158)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,143)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,135)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,128)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,120)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,113)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,105)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,98)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,90)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,83)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,75)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,68)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,60)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,53)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,45)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,38)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,30)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,23)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,15)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,8)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.70</text><text text-anchor="end" transform="translate(-7,295.5)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.71</text><text text-anchor="end" transform="translate(-7,288)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.72</text><text text-anchor="end" transform="translate(-7,280.5)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.73</text><text text-anchor="end" transform="translate(-7,273)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.74</text><text text-anchor="end" transform="translate(-7,265.5)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.75</text><text text-anchor="end" transform="translate(-7,258)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.76</text><text text-anchor="end" transform="translate(-7,250.5)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.77</text><text text-anchor="end" transform="translate(-7,242.99999999999994)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.78</text><text text-anchor="end" transform="translate(-7,235.49999999999997)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.79</text><text text-anchor="end" transform="translate(-7,227.99999999999997)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.80</text><text text-anchor="end" transform="translate(-7,220.49999999999997)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.81</text><text text-anchor="end" transform="translate(-7,212.99999999999994)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.82</text><text text-anchor="end" transform="translate(-7,205.49999999999994)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.83</text><text text-anchor="end" transform="translate(-7,197.99999999999994)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.84</text><text text-anchor="end" transform="translate(-7,190.49999999999994)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.85</text><text text-anchor="end" transform="translate(-7,182.99999999999991)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.86</text><text text-anchor="end" transform="translate(-7,175.49999999999991)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.87</text><text text-anchor="end" transform="translate(-7,168.00000000000009)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.88</text><text text-anchor="end" transform="translate(-7,160.5000000000001)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.89</text><text text-anchor="end" transform="translate(-7,153.00000000000006)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.90</text><text text-anchor="end" transform="translate(-7,145.50000000000009)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.91</text><text text-anchor="end" transform="translate(-7,138.00000000000009)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.92</text><text text-anchor="end" transform="translate(-7,130.50000000000009)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.93</text><text text-anchor="end" transform="translate(-7,123.00000000000007)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.94</text><text text-anchor="end" transform="translate(-7,115.50000000000007)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.95</text><text text-anchor="end" transform="translate(-7,108.00000000000006)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.96</text><text text-anchor="end" transform="translate(-7,100.50000000000006)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.97</text><text text-anchor="end" transform="translate(-7,93.00000000000004)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1.98</text><text text-anchor="end" transform="translate(-7,85.50000000000004)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1.99</text><text text-anchor="end" transform="translate(-7,78.00000000000003)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2.00</text><text text-anchor="end" transform="translate(-7,70.5000000000002)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2.01</text><text text-anchor="end" transform="translate(-7,63.00000000000002)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2.02</text><text text-anchor="end" transform="translate(-7,55.50000000000018)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2.03</text><text text-anchor="end" transform="translate(-7,48.00000000000004)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2.04</text><text text-anchor="end" transform="translate(-7,40.5000000000002)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2.05</text><text text-anchor="end" transform="translate(-7,33.00000000000003)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2.06</text><text text-anchor="end" transform="translate(-7,25.500000000000185)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2.07</text><text text-anchor="end" transform="translate(-7,18.000000000000014)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2.08</text><text text-anchor="end" transform="translate(-7,10.500000000000174)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2.09</text><text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2.10</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-title" style="pointer-events: none;"><text text-anchor="middle" transform="translate(-30.462890625,150) rotate(-90) translate(0,-2)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">Runtime (secs)</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-symbol role-mark concat_0_concat_0_layer_0_layer_0_marks"><path transform="translate(75,300)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/><path transform="translate(75,150.00000000000006)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/><path transform="translate(75,300)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/></g><g class="mark-rule role-mark concat_0_concat_0_layer_0_layer_1_layer_0_marks"><line transform="translate(25,224.99999999999997)" x2="0" y2="0" style="fill: none; stroke: black;"/><line transform="translate(75,239.99999999999994)" x2="0" y2="-1.8749999999999432" style="fill: none; stroke: black;"/></g><g class="mark-rule role-mark concat_0_concat_0_layer_0_layer_1_layer_1_marks"><line transform="translate(25,93.74999999999997)" x2="0" y2="-93.74999999999997" style="fill: none; stroke: black;"/><line transform="translate(75,224.99999999999997)" x2="0" y2="0" style="fill: none; stroke: black;"/></g><g class="mark-rect role-mark concat_0_concat_0_layer_1_layer_0_marks"><path d="M18,93.74999999999997h14v131.25h-14Z" style="fill: #66c2a5;"/><path d="M68,224.99999999999997h14v13.125000000000028h-14Z" style="fill: #fc8d62;"/></g><g class="mark-rect role-mark concat_0_concat_0_layer_1_layer_1_marks"><path d="M18,186.99999999999994h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M68,224.49999999999997h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-scope concat_0_concat_1_group"><g transform="translate(181,0)"><path class="background" d="M0.5,0.5h100v300h-100Z" style="fill: none; stroke: #ddd;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-grid" style="pointer-events: none;"><line transform="translate(0,300)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,288)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,277)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,265)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,254)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,242)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,231)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,219)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,208)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,196)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,185)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,173)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,162)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,138)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,127)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,115)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,104)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,92)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,81)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,69)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,58)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,46)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,35)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,23)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,12)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-group role-axis"><g transform="translate(0.5,300.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(25,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(75,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,288)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,277)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,265)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,254)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,242)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,231)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,219)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,208)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,196)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,185)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,173)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,162)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,138)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,127)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,115)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,104)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,92)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,81)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,69)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,58)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,46)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,35)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,23)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,12)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">480,000</text><text text-anchor="end" transform="translate(-7,291.46153846153845)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">485,000</text><text text-anchor="end" transform="translate(-7,279.92307692307696)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">490,000</text><text text-anchor="end" transform="translate(-7,268.38461538461536)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">495,000</text><text text-anchor="end" transform="translate(-7,256.8461538461538)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">500,000</text><text text-anchor="end" transform="translate(-7,245.30769230769232)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">505,000</text><text text-anchor="end" transform="translate(-7,233.76923076923075)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">510,000</text><text text-anchor="end" transform="translate(-7,222.23076923076925)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">515,000</text><text text-anchor="end" transform="translate(-7,210.69230769230768)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">520,000</text><text text-anchor="end" transform="translate(-7,199.15384615384616)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">525,000</text><text text-anchor="end" transform="translate(-7,187.6153846153846)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">530,000</text><text text-anchor="end" transform="translate(-7,176.07692307692307)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">535,000</text><text text-anchor="end" transform="translate(-7,164.53846153846152)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">540,000</text><text text-anchor="end" transform="translate(-7,153)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">545,000</text><text text-anchor="end" transform="translate(-7,141.46153846153848)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">550,000</text><text text-anchor="end" transform="translate(-7,129.92307692307693)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">555,000</text><text text-anchor="end" transform="translate(-7,118.38461538461537)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">560,000</text><text text-anchor="end" transform="translate(-7,106.84615384615384)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">565,000</text><text text-anchor="end" transform="translate(-7,95.3076923076923)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">570,000</text><text text-anchor="end" transform="translate(-7,83.76923076923079)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">575,000</text><text text-anchor="end" transform="translate(-7,72.23076923076921)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">580,000</text><text text-anchor="end" transform="translate(-7,60.692307692307686)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">585,000</text><text text-anchor="end" transform="translate(-7,49.15384615384615)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">590,000</text><text text-anchor="end" transform="translate(-7,37.61538461538463)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">595,000</text><text text-anchor="end" transform="translate(-7,26.076923076923062)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">600,000</text><text text-anchor="end" transform="translate(-7,14.538461538461531)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">605,000</text><text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">610,000</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-title" style="pointer-events: none;"><text text-anchor="middle" transform="translate(-47.1474609375,150) rotate(-90) translate(0,-2)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">Throughput (per sec)</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-symbol role-mark concat_0_concat_1_layer_0_layer_0_marks"><path transform="translate(75,168.99530769230782)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/><path transform="translate(75,22.52284615384622)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/></g><g class="mark-rule role-mark concat_0_concat_1_layer_0_layer_1_layer_0_marks"><line transform="translate(25,290.7066923076924)" x2="0" y2="-70.28861538461544" style="fill: none; stroke: black;"/><line transform="translate(75,139.72961538461539)" x2="0" y2="-10.538480769230887" style="fill: none; stroke: black;"/></g><g class="mark-rule role-mark concat_0_concat_1_layer_0_layer_1_layer_1_marks"><line transform="translate(25,143.20223076923088)" x2="0" y2="-45.210461538461686" style="fill: none; stroke: black;"/><line transform="translate(75,103.50542307692302)" x2="0" y2="-19.03119230769225" style="fill: none; stroke: black;"/></g><g class="mark-rect role-mark concat_0_concat_1_layer_1_layer_0_marks"><path d="M18,143.20223076923088h14v77.21584615384606h-14Z" style="fill: #66c2a5;"/><path d="M68,103.50542307692302h14v25.685711538461476h-14Z" style="fill: #fc8d62;"/></g><g class="mark-rect role-mark concat_0_concat_1_layer_1_layer_1_marks"><path d="M18,161.72903846153847h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M68,121.91096153846152h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-title"><g transform="translate(-42.462890625,-23)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-text role-title-text" style="pointer-events: none;"><text text-anchor="start" transform="translate(0,10)" style="font-family: sans-serif; font-size: 13px; font-weight: bold; fill: #000; opacity: 1;">1 million events</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-scope concat_1_group"><g transform="translate(425,0)"><path class="background" d="M0,0h0v0h0Z" style="fill: none;"/><g><g class="mark-group role-scope concat_1_concat_0_group"><g transform="translate(0,0)"><path class="background" d="M0.5,0.5h100v300h-100Z" style="fill: none; stroke: #ddd;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-grid" style="pointer-events: none;"><line transform="translate(0,300)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,288)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,275)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,262)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,250)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,238)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,225)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,212)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,200)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,187)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,175)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,163)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,137)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,125)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,113)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,100)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,87)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,75)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,62)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,50)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,38)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,25)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,12)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-group role-axis"><g transform="translate(0.5,300.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(25,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(75,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,288)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,275)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,262)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,250)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,238)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,225)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,212)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,200)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,187)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,175)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,163)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,137)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,125)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,113)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,100)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,87)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,75)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,62)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,50)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,38)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,25)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,12)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">12.6</text><text text-anchor="end" transform="translate(-7,290.50000000000006)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">12.7</text><text text-anchor="end" transform="translate(-7,277.9999999999999)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">12.8</text><text text-anchor="end" transform="translate(-7,265.49999999999994)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">12.9</text><text text-anchor="end" transform="translate(-7,252.99999999999997)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">13.0</text><text text-anchor="end" transform="translate(-7,240.50000000000003)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">13.1</text><text text-anchor="end" transform="translate(-7,228.00000000000006)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">13.2</text><text text-anchor="end" transform="translate(-7,215.4999999999999)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">13.3</text><text text-anchor="end" transform="translate(-7,202.99999999999991)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">13.4</text><text text-anchor="end" transform="translate(-7,190.49999999999997)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">13.5</text><text text-anchor="end" transform="translate(-7,178)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">13.6</text><text text-anchor="end" transform="translate(-7,165.50000000000009)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">13.7</text><text text-anchor="end" transform="translate(-7,152.9999999999999)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">13.8</text><text text-anchor="end" transform="translate(-7,140.49999999999994)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">13.9</text><text text-anchor="end" transform="translate(-7,127.99999999999999)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">14.0</text><text text-anchor="end" transform="translate(-7,115.50000000000003)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">14.1</text><text text-anchor="end" transform="translate(-7,103.00000000000007)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">14.2</text><text text-anchor="end" transform="translate(-7,90.49999999999989)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">14.3</text><text text-anchor="end" transform="translate(-7,77.99999999999993)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">14.4</text><text text-anchor="end" transform="translate(-7,65.49999999999997)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">14.5</text><text text-anchor="end" transform="translate(-7,53.00000000000002)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">14.6</text><text text-anchor="end" transform="translate(-7,40.500000000000064)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">14.7</text><text text-anchor="end" transform="translate(-7,27.99999999999991)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">14.8</text><text text-anchor="end" transform="translate(-7,15.499999999999956)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">14.9</text><text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">15.0</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-title" style="pointer-events: none;"><text text-anchor="middle" transform="translate(-30.462890625,150) rotate(-90) translate(0,-2)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">Runtime (secs)</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-symbol role-mark concat_1_concat_0_layer_0_layer_0_marks"/><g class="mark-rule role-mark concat_1_concat_0_layer_0_layer_1_layer_0_marks"><line transform="translate(25,74.99999999999993)" x2="0" y2="-3.125000000000014" style="fill: none; stroke: black;"/><line transform="translate(75,287.50000000000006)" x2="0" y2="0" style="fill: none; stroke: black;"/></g><g class="mark-rule role-mark concat_1_concat_0_layer_0_layer_1_layer_1_marks"><line transform="translate(25,31.24999999999999)" x2="0" y2="-18.750000000000036" style="fill: none; stroke: black;"/><line transform="translate(75,262.49999999999994)" x2="0" y2="-12.499999999999972" style="fill: none; stroke: black;"/></g><g class="mark-rect role-mark concat_1_concat_0_layer_1_layer_0_marks"><path d="M18,31.24999999999999h14v40.62499999999993h-14Z" style="fill: #66c2a5;"/><path d="M68,262.49999999999994h14v25.000000000000114h-14Z" style="fill: #fc8d62;"/></g><g class="mark-rect role-mark concat_1_concat_0_layer_1_layer_1_marks"><path d="M18,61.99999999999998h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M68,280.74999999999994h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-scope concat_1_concat_1_group"><g transform="translate(181,0)"><path class="background" d="M0.5,0.5h100v300h-100Z" style="fill: none; stroke: #ddd;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-grid" style="pointer-events: none;"><line transform="translate(0,300)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,288)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,277)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,265)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,254)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,242)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,231)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,219)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,208)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,196)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,185)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,173)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,162)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,138)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,127)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,115)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,104)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,92)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,81)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,69)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,58)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,46)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,35)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,23)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,12)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-group role-axis"><g transform="translate(0.5,300.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(25,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(75,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,288)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,277)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,265)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,254)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,242)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,231)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,219)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,208)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,196)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,185)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,173)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,162)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,138)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,127)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,115)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,104)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,92)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,81)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,69)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,58)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,46)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,35)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,23)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,12)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">660,000</text><text text-anchor="end" transform="translate(-7,291.46153846153845)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">665,000</text><text text-anchor="end" transform="translate(-7,279.92307692307696)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">670,000</text><text text-anchor="end" transform="translate(-7,268.38461538461536)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">675,000</text><text text-anchor="end" transform="translate(-7,256.8461538461538)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">680,000</text><text text-anchor="end" transform="translate(-7,245.30769230769232)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">685,000</text><text text-anchor="end" transform="translate(-7,233.76923076923075)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">690,000</text><text text-anchor="end" transform="translate(-7,222.23076923076925)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">695,000</text><text text-anchor="end" transform="translate(-7,210.69230769230768)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">700,000</text><text text-anchor="end" transform="translate(-7,199.15384615384616)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">705,000</text><text text-anchor="end" transform="translate(-7,187.6153846153846)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">710,000</text><text text-anchor="end" transform="translate(-7,176.07692307692307)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">715,000</text><text text-anchor="end" transform="translate(-7,164.53846153846152)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">720,000</text><text text-anchor="end" transform="translate(-7,153)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">725,000</text><text text-anchor="end" transform="translate(-7,141.46153846153848)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">730,000</text><text text-anchor="end" transform="translate(-7,129.92307692307693)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">735,000</text><text text-anchor="end" transform="translate(-7,118.38461538461537)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">740,000</text><text text-anchor="end" transform="translate(-7,106.84615384615384)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">745,000</text><text text-anchor="end" transform="translate(-7,95.3076923076923)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">750,000</text><text text-anchor="end" transform="translate(-7,83.76923076923079)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">755,000</text><text text-anchor="end" transform="translate(-7,72.23076923076921)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">760,000</text><text text-anchor="end" transform="translate(-7,60.692307692307686)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">765,000</text><text text-anchor="end" transform="translate(-7,49.15384615384615)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">770,000</text><text text-anchor="end" transform="translate(-7,37.61538461538463)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">775,000</text><text text-anchor="end" transform="translate(-7,26.076923076923062)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">780,000</text><text text-anchor="end" transform="translate(-7,14.538461538461531)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">785,000</text><text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">790,000</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-title" style="pointer-events: none;"><text text-anchor="middle" transform="translate(-47.1474609375,150) rotate(-90) translate(0,-2)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">Throughput (per sec)</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-symbol role-mark concat_1_concat_1_layer_0_layer_0_marks"/><g class="mark-rule role-mark concat_1_concat_1_layer_0_layer_1_layer_0_marks"><line transform="translate(25,269.5984615384615)" x2="0" y2="-12.500019230769283" style="fill: none; stroke: black;"/><line transform="translate(75,43.41138461538456)" x2="0" y2="-10.424076923076889" style="fill: none; stroke: black;"/></g><g class="mark-rule role-mark concat_1_concat_1_layer_0_layer_1_layer_1_marks"><line transform="translate(25,225.78126923076934)" x2="0" y2="-7.385653846154014" style="fill: none; stroke: black;"/><line transform="translate(75,7.6756730769230845)" x2="0" y2="-8.717134615384758" style="fill: none; stroke: black;"/></g><g class="mark-rect role-mark concat_1_concat_1_layer_1_layer_0_marks"><path d="M18,225.78126923076934h14v31.31717307692287h-14Z" style="fill: #66c2a5;"/><path d="M68,7.6756730769230845h14v25.31163461538459h-14Z" style="fill: #fc8d62;"/></g><g class="mark-rect role-mark concat_1_concat_1_layer_1_layer_1_marks"><path d="M18,233.1421923076922h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M68,12.763923076922957h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-title"><g transform="translate(-42.462890625,-23)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-text role-title-text" style="pointer-events: none;"><text text-anchor="start" transform="translate(0,10)" style="font-family: sans-serif; font-size: 13px; font-weight: bold; fill: #000; opacity: 1;">10 million events</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-legend"><g transform="translate(725,0)"><path class="background" d="M0,0h62v40h-62Z" style="pointer-events: none; fill: none;"/><g><g class="mark-group role-legend-entry"><g transform="translate(0,16)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-group role-scope"><g transform="translate(0,0)"><path class="background" d="M0,0h61.0146484375v11h-61.0146484375Z" style="pointer-events: none; fill: none; opacity: 1;"/><g><g class="mark-symbol role-legend-symbol" style="pointer-events: none;"><path transform="translate(6,6)" d="M-5,-5h10v10h-10Z" style="fill: #66c2a5; stroke-width: 1.5; opacity: 1;"/></g><g class="mark-text role-legend-label" style="pointer-events: none;"><text text-anchor="start" transform="translate(16,9)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">Canonical</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g><g transform="translate(0,13)"><path class="background" d="M0,0h61.0146484375v11h-61.0146484375Z" style="pointer-events: none; fill: none; opacity: 1;"/><g><g class="mark-symbol role-legend-symbol" style="pointer-events: none;"><path transform="translate(6,6)" d="M-5,-5h10v10h-10Z" style="fill: #fc8d62; stroke-width: 1.5; opacity: 1;"/></g><g class="mark-text role-legend-label" style="pointer-events: none;"><text text-anchor="start" transform="translate(16,9)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">Optimized</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-text role-legend-title" style="pointer-events: none;"><text text-anchor="start" transform="translate(0,9)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">Aggregator</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g></g></svg></p><ul>
<li>For both aggregators we observe a much lower throughput for the small dataset.
This indicates a fairly large general runtime overhead, as likely expected by everyone familiar with Beam and Spark.</li>
<li>The runtime of the <strong>optimized aggregator</strong> is better in both cases.
For the larger dataset the median runtime decreased by 13%.
For the small dataset the improvement is rather insignificant due to the overhead of the system.</li>
</ul>
<h3 class="mume-header" id="jmh-micro-benchmark">JMH micro-benchmark</h3>

<p>We expect the <code>reduce</code> operation to be the bottleneck of the aggregator: every single input row must be reduced into an aggregation buffer. The number of required merges, on the other hand, corresponds to the number of partitions in the system and is fairly low.</p>
<p>In the following we&#x2019;re going to compare the <code>reduce</code> throughput (<strong>Reduce Ops/sec</strong>) of the aggregators using Java micro-benchmarks. Events are generated such that new sessions are created with a certain probability (<strong>New session</strong>) (or get merged otherwise). Specifically, we&#x2019;re looking at two scenarios:</p>
<ol>
<li>
<p><strong>Random inserts</strong>: Unless a new session is created (in the future), the event is randomly merged with one or several existing sessions in the past.</p>
</li>
<li>
<p><strong>Sequential inserts</strong>: Unless a new session is created (in the future), the event is merged into the previous session.</p>
</li>
</ol>
<p>A significant difference between the two scenarios is the amount of session windows getting merged during a reduce operation, which is much higher in scenario 1. Consequently, the overall number of sessions doesn&#x2019;t grow as quickly.</p>
<h5 class="mume-header" id="results-1">Results</h5>

<p>The boxplot charts below visualize reduce operations per second (reduce throughput) for both scenarios based on 25 benchmark iterations each.
For better readability the two aggregators are presented separately on different scales.
The black bar depicts the median throughput.</p>
<p><!--?xml version="1.0" encoding="utf-8"?-->

<svg class="marks" width="738" height="369" viewBox="0 0 738 369" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink"><rect width="738" height="369" style="fill: white;"/><g transform="translate(54,27)"><g class="mark-group role-frame root"><g transform="translate(0,0)"><path class="background" d="M0,0h0v0h0Z" style="fill: none;"/><g><g class="mark-group role-scope concat_0_group"><g transform="translate(0,0)"><path class="background" d="M0,0h0v0h0Z" style="fill: none;"/><g><g class="mark-group role-row-header concat_0_row_header"><g transform="translate(-1,0)"><path class="background" d="M0,0h0v300h0Z" style="fill: none;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,288)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,277)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,265)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,254)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,242)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,231)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,219)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,208)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,196)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,185)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,173)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,162)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,138)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,127)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,115)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,104)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,92)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,81)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,69)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,58)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,46)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,35)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,23)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,12)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,000</text><text text-anchor="end" transform="translate(-7,291.46153846153845)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1,100</text><text text-anchor="end" transform="translate(-7,279.92307692307696)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,200</text><text text-anchor="end" transform="translate(-7,268.38461538461536)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1,300</text><text text-anchor="end" transform="translate(-7,256.8461538461538)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,400</text><text text-anchor="end" transform="translate(-7,245.30769230769232)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1,500</text><text text-anchor="end" transform="translate(-7,233.76923076923075)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,600</text><text text-anchor="end" transform="translate(-7,222.23076923076925)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1,700</text><text text-anchor="end" transform="translate(-7,210.69230769230768)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,800</text><text text-anchor="end" transform="translate(-7,199.15384615384616)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1,900</text><text text-anchor="end" transform="translate(-7,187.6153846153846)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2,000</text><text text-anchor="end" transform="translate(-7,176.07692307692307)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2,100</text><text text-anchor="end" transform="translate(-7,164.53846153846152)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2,200</text><text text-anchor="end" transform="translate(-7,153)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2,300</text><text text-anchor="end" transform="translate(-7,141.46153846153848)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2,400</text><text text-anchor="end" transform="translate(-7,129.92307692307693)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2,500</text><text text-anchor="end" transform="translate(-7,118.38461538461537)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2,600</text><text text-anchor="end" transform="translate(-7,106.84615384615384)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2,700</text><text text-anchor="end" transform="translate(-7,95.3076923076923)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">2,800</text><text text-anchor="end" transform="translate(-7,83.76923076923079)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">2,900</text><text text-anchor="end" transform="translate(-7,72.23076923076921)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">3,000</text><text text-anchor="end" transform="translate(-7,60.692307692307686)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">3,100</text><text text-anchor="end" transform="translate(-7,49.15384615384615)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">3,200</text><text text-anchor="end" transform="translate(-7,37.61538461538463)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">3,300</text><text text-anchor="end" transform="translate(-7,26.076923076923062)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">3,400</text><text text-anchor="end" transform="translate(-7,14.538461538461531)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">3,500</text><text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">3,600</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-title" style="pointer-events: none;"><text text-anchor="middle" transform="translate(-36.0244140625,150) rotate(-90) translate(0,-2)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">Reduce Ops/sec</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-column-header concat_0_column_header"><g transform="translate(0,-1)"><path class="background" d="M0,0h100v0h-100Z" style="fill: none;"/><g><g class="mark-group role-title"><g transform="translate(50,-20)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-text role-title-text" style="pointer-events: none;"><text text-anchor="middle" transform="translate(0,8)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">Random inserts</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g><g transform="translate(122,-1)"><path class="background" d="M0,0h100v0h-100Z" style="fill: none;"/><g><g class="mark-group role-title"><g transform="translate(50,-20)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-text role-title-text" style="pointer-events: none;"><text text-anchor="middle" transform="translate(0,8)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">Sequential inserts</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-column-footer concat_0_column_footer"><g transform="translate(0,301)"><path class="background" d="M0,0h100v0h-100Z" style="fill: none;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(16,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(50,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(83,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(16.166666666666668,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.1</text><text text-anchor="end" transform="translate(49.5,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.2</text><text text-anchor="end" transform="translate(82.83333333333334,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.4</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-title" style="pointer-events: none;"><text text-anchor="middle" transform="translate(50,33.9013671875)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">New session</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g><g transform="translate(122,301)"><path class="background" d="M0,0h100v0h-100Z" style="fill: none;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(16,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(50,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(83,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(16.166666666666668,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.1</text><text text-anchor="end" transform="translate(49.5,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.2</text><text text-anchor="end" transform="translate(82.83333333333334,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.4</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-title" style="pointer-events: none;"><text text-anchor="middle" transform="translate(50,33.9013671875)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">New session</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-scope concat_0_cell"><g transform="translate(0,0)"><path class="background" d="M0.5,0.5h100v300h-100Z" style="fill: none; stroke: #ddd;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-grid" style="pointer-events: none;"><line transform="translate(0,300)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,288)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,277)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,265)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,254)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,242)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,231)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,219)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,208)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,196)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,185)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,173)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,162)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,138)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,127)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,115)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,104)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,92)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,81)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,69)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,58)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,46)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,35)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,23)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,12)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-symbol role-mark concat_0_child_layer_0_layer_0_marks"><path transform="translate(50,290.94298073612237)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/></g><g class="mark-rule role-mark concat_0_child_layer_0_layer_1_layer_0_marks"><line transform="translate(16.666666666666668,286.3441687749684)" x2="0" y2="-6.163227957649099" style="fill: none; stroke: black;"/><line transform="translate(50,288.9334327017179)" x2="0" y2="-3.472443243613384" style="fill: none; stroke: black;"/><line transform="translate(83.33333333333334,298.7027381986361)" x2="0" y2="-3.676350666408723" style="fill: none; stroke: black;"/></g><g class="mark-rule role-mark concat_0_child_layer_0_layer_1_layer_1_marks"><line transform="translate(16.666666666666668,275.0554602518657)" x2="0" y2="-5.138185609806442" style="fill: none; stroke: black;"/><line transform="translate(50,281.89921578651246)" x2="0" y2="-2.4812526605438165" style="fill: none; stroke: black;"/><line transform="translate(83.33333333333334,291.20392558217424)" x2="0" y2="-3.48191166235506" style="fill: none; stroke: black;"/></g><g class="mark-rect role-mark concat_0_child_layer_1_layer_0_marks"><path d="M9.666666666666668,275.0554602518657h14v5.125480565453586h-14Z" style="fill: #4c78a8;"/><path d="M43,281.89921578651246h14v3.56177367159205h-14Z" style="fill: #4c78a8;"/><path d="M76.33333333333334,291.20392558217424h14v3.822461950053139h-14Z" style="fill: #4c78a8;"/></g><g class="mark-rect role-mark concat_0_child_layer_1_layer_1_marks"><path d="M9.666666666666668,276.96139916604426h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M43,283.6971369677014h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M76.33333333333334,291.6717776984763h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g><g transform="translate(122,0)"><path class="background" d="M0.5,0.5h100v300h-100Z" style="fill: none; stroke: #ddd;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-grid" style="pointer-events: none;"><line transform="translate(0,300)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,288)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,277)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,265)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,254)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,242)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,231)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,219)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,208)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,196)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,185)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,173)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,162)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,138)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,127)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,115)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,104)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,92)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,81)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,69)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,58)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,46)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,35)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,23)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,12)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-symbol role-mark concat_0_child_layer_0_layer_0_marks"><path transform="translate(16.666666666666668,17.010197958910954)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/><path transform="translate(50,130.6218823450987)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/><path transform="translate(50,140.72474594151194)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/></g><g class="mark-rule role-mark concat_0_child_layer_0_layer_1_layer_0_marks"><line transform="translate(16.666666666666668,15.062465260756808)" x2="0" y2="-3.9831494082149472" style="fill: none; stroke: black;"/><line transform="translate(50,130.15083939621772)" x2="0" y2="-2.372498085609436" style="fill: none; stroke: black;"/><line transform="translate(83.33333333333334,218.8059985452753)" x2="0" y2="-0.43212645835518515" style="fill: none; stroke: black;"/></g><g class="mark-rule role-mark concat_0_child_layer_0_layer_1_layer_1_marks"><line transform="translate(16.666666666666668,7.315829584459088)" x2="0" y2="-2.6929913884320644" style="fill: none; stroke: black;"/><line transform="translate(50,125.99028864515962)" x2="0" y2="-1.279576780174807" style="fill: none; stroke: black;"/><line transform="translate(83.33333333333334,217.46911532819828)" x2="0" y2="-1.1885980309051547" style="fill: none; stroke: black;"/></g><g class="mark-rect role-mark concat_0_child_layer_1_layer_0_marks"><path d="M9.666666666666668,7.315829584459088h14v3.7634862680827723h-14Z" style="fill: #4c78a8;"/><path d="M43,125.99028864515962h14v1.7880526654486602h-14Z" style="fill: #4c78a8;"/><path d="M76.33333333333334,217.46911532819828h14v0.9047567587218168h-14Z" style="fill: #4c78a8;"/></g><g class="mark-rect role-mark concat_0_child_layer_1_layer_1_marks"><path d="M9.666666666666668,8.379988158698781h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M43,126.66617615069339h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M76.33333333333334,217.609544814594h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-scope concat_1_group"><g transform="translate(376,0)"><path class="background" d="M0,0h0v0h0Z" style="fill: none;"/><g><g class="mark-group role-row-header concat_1_row_header"><g transform="translate(-1,0)"><path class="background" d="M0,0h0v300h0Z" style="fill: none;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,286)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,273)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,259)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,245)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,232)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,218)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,205)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,191)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,177)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,164)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,136)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,123)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,109)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,95)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,82)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,68)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,55)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,41)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,27)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,14)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">300,000</text><text text-anchor="end" transform="translate(-7,289.3636363636364)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">350,000</text><text text-anchor="end" transform="translate(-7,275.7272727272727)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">400,000</text><text text-anchor="end" transform="translate(-7,262.0909090909091)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">450,000</text><text text-anchor="end" transform="translate(-7,248.45454545454544)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">500,000</text><text text-anchor="end" transform="translate(-7,234.8181818181818)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">550,000</text><text text-anchor="end" transform="translate(-7,221.1818181818182)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">600,000</text><text text-anchor="end" transform="translate(-7,207.54545454545456)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">650,000</text><text text-anchor="end" transform="translate(-7,193.9090909090909)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">700,000</text><text text-anchor="end" transform="translate(-7,180.27272727272725)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">750,000</text><text text-anchor="end" transform="translate(-7,166.63636363636363)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">800,000</text><text text-anchor="end" transform="translate(-7,153)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">850,000</text><text text-anchor="end" transform="translate(-7,139.36363636363637)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">900,000</text><text text-anchor="end" transform="translate(-7,125.72727272727272)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">950,000</text><text text-anchor="end" transform="translate(-7,112.0909090909091)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,000,000</text><text text-anchor="end" transform="translate(-7,98.45454545454547)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1,050,000</text><text text-anchor="end" transform="translate(-7,84.81818181818181)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,100,000</text><text text-anchor="end" transform="translate(-7,71.18181818181819)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1,150,000</text><text text-anchor="end" transform="translate(-7,57.54545454545453)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,200,000</text><text text-anchor="end" transform="translate(-7,43.90909090909091)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1,250,000</text><text text-anchor="end" transform="translate(-7,30.27272727272728)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,300,000</text><text text-anchor="end" transform="translate(-7,16.636363636363626)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;">1,350,000</text><text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">1,400,000</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-column-header concat_1_column_header"><g transform="translate(0,-2)"><path class="background" d="M0,0h100v0h-100Z" style="fill: none;"/><g><g class="mark-group role-title"><g transform="translate(50,-20)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-text role-title-text" style="pointer-events: none;"><text text-anchor="middle" transform="translate(0,8)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">Random inserts</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g><g transform="translate(122,-2)"><path class="background" d="M0,0h100v0h-100Z" style="fill: none;"/><g><g class="mark-group role-title"><g transform="translate(50,-20)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-text role-title-text" style="pointer-events: none;"><text text-anchor="middle" transform="translate(0,8)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">Sequential inserts</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-column-footer concat_1_column_footer"><g transform="translate(0,301)"><path class="background" d="M0,0h100v0h-100Z" style="fill: none;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(16,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(50,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(83,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(16.166666666666668,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.1</text><text text-anchor="end" transform="translate(49.5,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.2</text><text text-anchor="end" transform="translate(82.83333333333334,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.4</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-title" style="pointer-events: none;"><text text-anchor="middle" transform="translate(50,33.9013671875)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">New session</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g><g transform="translate(122,301)"><path class="background" d="M0,0h100v0h-100Z" style="fill: none;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-tick" style="pointer-events: none;"><line transform="translate(16,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(50,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/><line transform="translate(83,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-label" style="pointer-events: none;"><text text-anchor="end" transform="translate(16.166666666666668,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.1</text><text text-anchor="end" transform="translate(49.5,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.2</text><text text-anchor="end" transform="translate(82.83333333333334,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">0.4</text></g><g class="mark-rule role-axis-domain" style="pointer-events: none;"><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"/></g><g class="mark-text role-axis-title" style="pointer-events: none;"><text text-anchor="middle" transform="translate(50,33.9013671875)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">New session</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-scope concat_1_cell"><g transform="translate(0,0)"><path class="background" d="M0.5,0.5h100v300h-100Z" style="fill: none; stroke: #ddd;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-grid" style="pointer-events: none;"><line transform="translate(0,300)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,286)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,273)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,259)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,245)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,232)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,218)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,205)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,191)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,177)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,164)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,136)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,123)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,109)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,95)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,82)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,68)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,55)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,41)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,27)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,14)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-symbol role-mark concat_1_child_layer_0_layer_0_marks"/><g class="mark-rule role-mark concat_1_child_layer_0_layer_1_layer_0_marks"><line transform="translate(16.666666666666668,272.82312155406254)" x2="0" y2="-6.252658120926128" style="fill: none; stroke: black;"/><line transform="translate(50,270.65950479629885)" x2="0" y2="-10.520358941724794" style="fill: none; stroke: black;"/><line transform="translate(83.33333333333334,233.57165393437805)" x2="0" y2="-8.647074397826401" style="fill: none; stroke: black;"/></g><g class="mark-rule role-mark concat_1_child_layer_0_layer_1_layer_1_marks"><line transform="translate(16.666666666666668,259.844131053521)" x2="0" y2="-6.350729095502828" style="fill: none; stroke: black;"/><line transform="translate(50,247.56774233963833)" x2="0" y2="-15.414768443447798" style="fill: none; stroke: black;"/><line transform="translate(83.33333333333334,211.5802567727587)" x2="0" y2="-5.139929876231406" style="fill: none; stroke: black;"/></g><g class="mark-rect role-mark concat_1_child_layer_1_layer_0_marks"><path d="M9.666666666666668,259.844131053521h14v6.726332379615428h-14Z" style="fill: #f58518;"/><path d="M43,247.56774233963833h14v12.571403514935724h-14Z" style="fill: #f58518;"/><path d="M76.33333333333334,211.5802567727587h14v13.344322763792945h-14Z" style="fill: #f58518;"/></g><g class="mark-rect role-mark concat_1_child_layer_1_layer_1_marks"><path d="M9.666666666666668,262.0017451561318h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M43,252.93904726700057h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M76.33333333333334,218.02760048949548h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g><g transform="translate(122,0)"><path class="background" d="M0.5,0.5h100v300h-100Z" style="fill: none; stroke: #ddd;"/><g><g class="mark-group role-axis"><g transform="translate(0.5,0.5)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-rule role-axis-grid" style="pointer-events: none;"><line transform="translate(0,300)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,286)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,273)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,259)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,245)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,232)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,218)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,205)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,191)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,177)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,164)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,150)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,136)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,123)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,109)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,95)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,82)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,68)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,55)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,41)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,27)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,14)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/><line transform="translate(0,0)" x2="100" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"/></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-symbol role-mark concat_1_child_layer_0_layer_0_marks"><path transform="translate(50,87.33357683382754)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/><path transform="translate(83.33333333333334,73.11117460261232)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" style="fill: none; stroke: #4c78a8; stroke-width: 2; opacity: 0.7;"/></g><g class="mark-rule role-mark concat_1_child_layer_0_layer_1_layer_0_marks"><line transform="translate(16.666666666666668,113.27384281137955)" x2="0" y2="-24.47585322864836" style="fill: none; stroke: black;"/><line transform="translate(50,73.88022081774072)" x2="0" y2="-26.90181961633791" style="fill: none; stroke: black;"/><line transform="translate(83.33333333333334,57.113808336244134)" x2="0" y2="-18.8240366741964" style="fill: none; stroke: black;"/></g><g class="mark-rule role-mark concat_1_child_layer_0_layer_1_layer_1_marks"><line transform="translate(16.666666666666668,44.84579262334738)" x2="0" y2="-19.21463818273753" style="fill: none; stroke: black;"/><line transform="translate(50,28.316459355856704)" x2="0" y2="-21.230924572535024" style="fill: none; stroke: black;"/><line transform="translate(83.33333333333334,17.10187428908958)" x2="0" y2="-16.43004634810784" style="fill: none; stroke: black;"/></g><g class="mark-rect role-mark concat_1_child_layer_1_layer_0_marks"><path d="M9.666666666666668,44.84579262334738h14v43.95219695938381h-14Z" style="fill: #f58518;"/><path d="M43,28.316459355856704h14v18.661941845546107h-14Z" style="fill: #f58518;"/><path d="M76.33333333333334,17.10187428908958h14v21.187897372958155h-14Z" style="fill: #f58518;"/></g><g class="mark-rect role-mark concat_1_child_layer_1_layer_1_marks"><path d="M9.666666666666668,47.7364332099902h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M43,31.18575394272416h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/><path d="M76.33333333333334,26.63840693536357h14v1h-14Z" style="fill: white; stroke: black; stroke-width: 1; opacity: 0.7;"/></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g><g class="mark-group role-legend"><g transform="translate(617,0)"><path class="background" d="M0,0h62v40h-62Z" style="pointer-events: none; fill: none;"/><g><g class="mark-group role-legend-entry"><g transform="translate(0,16)"><path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"/><g><g class="mark-group role-scope"><g transform="translate(0,0)"><path class="background" d="M0,0h61.0146484375v11h-61.0146484375Z" style="pointer-events: none; fill: none; opacity: 1;"/><g><g class="mark-symbol role-legend-symbol" style="pointer-events: none;"><path transform="translate(6,6)" d="M-5,-5h10v10h-10Z" style="fill: #4c78a8; stroke-width: 1.5; opacity: 1;"/></g><g class="mark-text role-legend-label" style="pointer-events: none;"><text text-anchor="start" transform="translate(16,9)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">Canonical</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g><g transform="translate(0,13)"><path class="background" d="M0,0h61.0146484375v11h-61.0146484375Z" style="pointer-events: none; fill: none; opacity: 1;"/><g><g class="mark-symbol role-legend-symbol" style="pointer-events: none;"><path transform="translate(6,6)" d="M-5,-5h10v10h-10Z" style="fill: #f58518; stroke-width: 1.5; opacity: 1;"/></g><g class="mark-text role-legend-label" style="pointer-events: none;"><text text-anchor="start" transform="translate(16,9)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;">Optimized</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g><g class="mark-text role-legend-title" style="pointer-events: none;"><text text-anchor="start" transform="translate(0,9)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;">Aggregator</text></g></g><path class="foreground" d="" style="pointer-events: none; display: none; fill: none;"/></g></g></g><path class="foreground" d="" style="display: none; fill: none;"/></g></g></g></svg></p><ul>
<li>
<p>Reduce throughput of the <strong>optimized aggregator</strong> is orders of magnitude higher (400 to 750x).</p>
</li>
<li>
<p>The higher the probability of creating new sessions for the <strong>canonical aggregator</strong>, the more reduce throughput drops.</p>
<ul>
<li>This is due to the overhead of sorting session windows as part of Beam&#x2019;s canonical window merging (see above).
Obviously, the more windows there are, the more expensive this gets.</li>
<li>In scenario 1 this effect is alleviated as the growth factor is reduced due to additional merges.
However, the reduce throughput is also far less in this case. The costs of merging intersecting session windows and replacing them in the buffer decreases throughput to up to 1/3.</li>
</ul>
</li>
<li>
<p>The <strong>optimized aggregator</strong> shows the opposite picture.
Larger number of sessions are handled efficiently and throughput increases for higher new session probabilities.</p>
<ul>
<li>For scenario 1 we observe a similar behavior as seen for the canonical aggregator. Throughput is also reduced to up to 1/3 due to the costs of merging interseting session windows and manipulating the buffer accordingly.</li>
</ul>
</li>
</ul>
<p>The full benchmark code is available on <a href="https://github.com/apache/beam/commit/af41fbfde5d559cfd810eced62e0a4486dbb5daa"><img src="github.png" style="height:16px;"> apache/beam</a> for reference.</p>
<h2 class="mume-header" id="summary">Summary</h2>

<p>Using a specialized aggregator on session windows, we can avoid performance bottlenecks due to limitations in Beam&#x2019;s canonical window merging and boost the overall performance of pipelines containing aggregations over session windows when using the experimental Spark dataset runner.
The actual performance gain will highly depend on the input datasets, but can be very significant if the number of sessions per key is high.</p>
<p>With the effort presented here we are pushing the experimental Spark dataset runner one step further towards an efficient and reliable runner for Apache Beam. Nevertheless, there&#x2019;s a lot more work left to do.</p>

      </div>
      
      
    
    
    <script>
// config mermaid init call
// http://knsv.github.io/mermaid/#configuration
//
// You can edit the 'MERMAID_CONFIG' variable below.
MERMAID_CONFIG = {
  startOnLoad: false
}

if (window['MERMAID_CONFIG']) {
  window['MERMAID_CONFIG'].startOnLoad = false
  window['MERMAID_CONFIG'].cloneCssStyles = false
  window['MERMAID_CONFIG'].theme = "default"
}
mermaid.initialize(window['MERMAID_CONFIG'] || {})
if (typeof(window['Reveal']) !== 'undefined') {
  function mermaidRevealHelper(event) {
    var currentSlide = event.currentSlide
    var diagrams = currentSlide.querySelectorAll('.mermaid')
    for (var i = 0; i < diagrams.length; i++) {
      var diagram = diagrams[i]
      if (!diagram.hasAttribute('data-processed')) {
        mermaid.init(null, diagram, ()=> {
          Reveal.slide(event.indexh, event.indexv)
        })
      }
    }
  }
  Reveal.addEventListener('slidechanged', mermaidRevealHelper)
  Reveal.addEventListener('ready', mermaidRevealHelper)
} else {
  mermaid.init(null, document.getElementsByClassName('mermaid'))
}
</script>
    
    
    
    
    
  
    </body></html>